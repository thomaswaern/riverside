"use strict";var app,record;$(function(){$("a[href*=#]:not([href=#])").on("click",function(){var a=this.hash.slice(1);switch(a){case"audio":"audio"!==app.currentPage&&record.playSoundEffect("end",!0);break;case"video":record.stopAllSounds();break;case"contact":record.stopAllSounds()}app.setCurrentPage(a),app.load(a)})});var App=function(a){var b="audio";return{getCurrentPage:function(){return this._currentPage},setCurrentPage:function(a){b=a},load:function(b){console.log("preparing load"),a.ajax({context:this,dataType:"html",url:"templates/"+b+".html",error:function(){console.log("error")},success:function(b){console.log("loaded"),a("#wrapper").html(b),SC.whenStreamingReady(function(){setTimeout(function(){SC.get("/playlists/2373914",function(a){record.setTracks(a.tracks)}.bind(this))}.bind(this),2200)}),record.prepare()}})}}},Record=function(a){var b,c={crackling:new Audio("../sounds/needle.ogg"),end:new Audio("../sounds/endloop.ogg")},d=[],e=0,f=0,g=0;return{getCurrentTrack:function(){return d[f]},setCurrentTrack:function(a){f=a},setTracks:function(a){d=a,e=0,d.forEach(function(a){e+=a.duration}),this.setLabel()},setLabel:function(){var b="",c=1;d.forEach(function(a){b+="<br>",b+=c++ +". ",b+=a.title.substr(0,a.title.indexOf(" -"))}),a(".record").find(".title").html(b)},onPosition:function(){var a=g+b.position;this.setArmRotation(a/e)},setArmRotation:function(b){var c=51*(1-b);a(".slider").val(c+24,!0)},prepare:function(){console.log("preparing sliders"),a(".slider").noUiSlider({start:24,handles:1,range:{min:24,max:75}}),a(".slider").change(function(b){console.log("change"),record.armMoving=!1,record.setPosition(a(b.target).val(),24,75)}),a(".slider").on({slide:function(){record.armMoving=!0,console.log("moving"),a(".arm").css("-webkit-animation","none"),a(".arm").css("-webkit-transform","rotate(-"+a(".slider").val()+"deg)"),a(".slider").css("-webkit-transform","rotate(-"+a(".slider").val()/3+"deg)")},set:function(){console.log("set"),a(".arm").css("-webkit-transform","rotate(-"+a(".slider").val()+"deg)")}}),a(".arm").css("-webkit-animation","wobblearm 4.3s infinite"),a(".record").css("-webkit-animation","rotating 4.3s linear infinite"),this.playSoundEffect("end",!0)},setPosition:function(a,c,h){var i,j=1-(a-c)/(h-c),k=e*j,l=0,m=0,n=!1;d.forEach(function(a){n||(l+=a.duration,l>k?(i=k-(l-a.duration),g=l-a.duration,n=!0):m++)}),b&&b.playState>0&&f===m?b.setPosition(i):(f=m,this.playCurrentTrack(i))},next:function(){g+=d[f].duration;try{b.stop()}catch(a){}f>=d.length-1||(f++,this.playCurrentTrack(0))},playCurrentTrack:function(a){try{b.stop()}catch(c){}this.getCurrentTrack()&&"undefined"!==this.getCurrentTrack()&&SC.stream("/tracks/"+this.getCurrentTrack().id,{whileplaying:function(){!record.armMoving&&b.loaded&&this.onPosition()}.bind(this),autoLoad:!0},function(c){b=c,this.playSoundEffect("crackling",!1),b.setVolume(0),b.play({onload:function(){b.setVolume(90),b.setPosition(a)},onfinish:function(){record.next()}})}.bind(this))},playSoundEffect:function(a,b){c[a].loop=b,c[a].play()},stopAllSounds:function(){for(var a in c)c[a].pause();try{b.stop()}catch(d){}},initSoundcloud:this.initSoundcloud}};app=new App(jQuery),record=new Record(jQuery),app.load("audio");